@model HizliOgren.Models.User
@{
  ViewData["Title"] = "Profilim";
}
<div class="card" style="padding: 24px; max-width: 720px;">
  <h2>Profil Bilgilerim</h2>
  <p class="form-text" style="margin-bottom: 20px;">Bu bilgiler eÄŸitim sayfalarÄ±nda ve Ã¶ÄŸrenciler tarafÄ±ndan gÃ¶rÃ¼lebilir.</p>
  <form asp-action="Index" method="post">
    @Html.AntiForgeryToken()
    <div class="form-row" style="display: flex; gap: 24px; flex-wrap: wrap;">
      <div style="flex: 1; min-width: 200px;">
        <div class="form-group">
          <label asp-for="FullName">Ad Soyad</label>
          <input asp-for="FullName" class="form-control" required maxlength="200" />
          <span asp-validation-for="FullName" class="text-danger"></span>
        </div>
        <div class="form-group">
          <label>E-posta</label>
          <input type="text" class="form-control" value="@Model.Email" disabled readonly style="background: var(--bg-soft);" />
          <p class="form-text" style="margin-top: 4px;">E-posta deÄŸiÅŸtirmek iÃ§in yÃ¶netici ile iletiÅŸime geÃ§in.</p>
        </div>
        <div class="form-group">
          <label asp-for="Title">Unvan</label>
          <input asp-for="Title" class="form-control" maxlength="150" placeholder="Ã–rn. YazÄ±lÄ±m EÄŸitmeni" />
        </div>
        <div class="form-group">
          <label asp-for="City">Åžehir</label>
          <select asp-for="City" class="form-control" asp-items="ViewBag.CityList"></select>
        </div>
        <div class="form-group">
          <label asp-for="Phone">Telefon</label>
          <input asp-for="Phone" class="form-control" maxlength="50" placeholder="Ä°steÄŸe baÄŸlÄ±" />
        </div>
      </div>
      <div class="form-group" style="min-width: 160px;">
        <label asp-for="AvatarUrl">Profil fotoÄŸrafÄ±</label>
        <input type="hidden" asp-for="AvatarUrl" id="AvatarUrl" />
        <div style="border: 1px dashed var(--border); border-radius: var(--radius-sm); padding: 12px; background: var(--bg-soft); text-align: center;">
          <img id="avatar-preview" src="@(Model.AvatarUrl ?? "")" alt="Profil" style="width: 120px; height: 120px; object-fit: cover; border-radius: 50%; display: @(string.IsNullOrEmpty(Model.AvatarUrl) ? "none" : "block"); margin: 0 auto 8px;" />
          <span id="avatar-placeholder" style="font-size: 0.85rem; color: var(--text-muted); display: @(string.IsNullOrEmpty(Model.AvatarUrl) ? "block" : "none");">FotoÄŸraf yok</span>
          <button type="button" id="avatar-upload-btn" class="btn btn-ghost" style="margin-top: 8px; font-size: 0.9rem;">ðŸ“· YÃ¼kle</button>
          <input type="file" id="avatar-upload" accept=".jpg,.jpeg,.png,.gif,.webp" style="display: none;" />
        </div>
      </div>
    </div>
    <div class="form-group">
      <label asp-for="Bio">KÄ±sa biyografi / HakkÄ±nda</label>
      <textarea asp-for="Bio" class="form-control" rows="4" maxlength="2000" placeholder="Kendinizi ve uzmanlÄ±k alanlarÄ±nÄ±zÄ± kÄ±saca tanÄ±tÄ±n. EÄŸitim sayfalarÄ±nda gÃ¶rÃ¼nÃ¼r."></textarea>
      <p class="form-text" style="margin-top: 4px;">En fazla 2000 karakter.</p>
    </div>
    <button type="submit" class="btn btn-primary">Kaydet</button>
    <a asp-controller="Home" asp-action="Index" class="btn btn-ghost">Ä°ptal</a>
  </form>
</div>
@section Scripts {
  <partial name="_ValidationScriptsPartial" />
  <script>
    (function() {
      var uploadUrl = '@Url.Action("Image", "Upload", new { area = "" })';
      var tokenEl = document.querySelector('input[name="__RequestVerificationToken"]');
      var token = tokenEl ? tokenEl.value : '';
      var btn = document.getElementById('avatar-upload-btn');
      var input = document.getElementById('avatar-upload');
      var preview = document.getElementById('avatar-preview');
      var placeholder = document.getElementById('avatar-placeholder');
      var urlInput = document.getElementById('AvatarUrl');
      if (btn && input) {
        btn.addEventListener('click', function() { input.click(); });
        input.addEventListener('change', function() {
          var file = input.files && input.files[0];
          if (!file) return;
          var data = new FormData();
          data.append('upload', file);
          if (token) data.append('__RequestVerificationToken', token);
          btn.disabled = true;
          fetch(uploadUrl, { method: 'POST', body: data, credentials: 'same-origin' })
            .then(function(r) { return r.json(); })
            .then(function(res) {
              if (res.error) throw new Error(res.error.message);
              if (urlInput) urlInput.value = res.url;
              if (preview) { preview.src = res.url; preview.style.display = 'block'; }
              if (placeholder) placeholder.style.display = 'none';
            })
            .catch(function(err) { alert(err.message || 'YÃ¼kleme hatasÄ±'); })
            .finally(function() { btn.disabled = false; input.value = ''; });
        });
      }
    })();
  </script>
}
